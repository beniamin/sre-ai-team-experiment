
PLAY [Apply host-level firewall compensations on Proxmox nodes] ****************

TASK [Ensure nftables present] *************************************************
[WARNING]: Host '192.168.10.201' is using the discovered Python interpreter at '/usr/bin/python3.13', but future installation of another Python interpreter could cause a different interpreter to be discovered. See https://docs.ansible.com/ansible-core/2.19/reference_appendices/interpreter_discovery.html for more information.
ok: [192.168.10.201]
[WARNING]: Host '192.168.10.202' is using the discovered Python interpreter at '/usr/bin/python3.13', but future installation of another Python interpreter could cause a different interpreter to be discovered. See https://docs.ansible.com/ansible-core/2.19/reference_appendices/interpreter_discovery.html for more information.
ok: [192.168.10.202]

TASK [Ensure nftables service enabled and started] *****************************
ok: [192.168.10.201]
ok: [192.168.10.202]

TASK [Ensure /etc/nftables.d exists] *******************************************
ok: [192.168.10.201]
ok: [192.168.10.202]

TASK [Render nftables management table from template] **************************
changed: [192.168.10.201]
changed: [192.168.10.202]

TASK [Ensure nftables includes proxmox-mgmt table] *****************************
[ERROR]: Task failed: Module failed: non-zero return code
Origin: /app/config/ansible_proxmox_hardening/play_host_firewall_compensations.yml:37:7

35       become: true
36
37     - name: Ensure nftables includes proxmox-mgmt table
         ^ column 7

fatal: [192.168.10.201]: FAILED! => {"changed": true, "cmd": ["nft", "-f", "/etc/nftables.d/50-proxmox-mgmt.nft"], "delta": "0:00:00.007960", "end": "2026-02-26 16:07:06.972863", "msg": "non-zero return code", "rc": 1, "start": "2026-02-26 16:07:06.964903", "stderr": "/etc/nftables.d/50-proxmox-mgmt.nft:10:14-14: Error: syntax error, unexpected '['\n    ip saddr [ tcp dport 22 accept;\n             ^\n/etc/nftables.d/50-proxmox-mgmt.nft:11:14-14: Error: syntax error, unexpected '['\n    ip saddr [ tcp dport 8006 accept;\n             ^\n/etc/nftables.d/50-proxmox-mgmt.nft:12:14-14: Error: syntax error, unexpected '['\n    ip saddr [ udp dport 5404 accept;\n             ^\n/etc/nftables.d/50-proxmox-mgmt.nft:13:14-14: Error: syntax error, unexpected '['\n    ip saddr [ udp dport 5405 accept;\n             ^\n/etc/nftables.d/50-proxmox-mgmt.nft:14:14-14: Error: syntax error, unexpected junk\n    ip saddr ' tcp dport 22 accept;\n             ^\n/etc/nftables.d/50-proxmox-mgmt.nft:15:14-14: Error: syntax error, unexpected junk\n    ip saddr ' tcp dport 8006 accept;\n             ^\n/etc/nftables.d/50-proxmox-mgmt.nft:16:14-14: Error: syntax error, unexpected junk\n    ip saddr ' udp dport 5404 accept;\n             ^\n/etc/nftables.d/50-proxmox-mgmt.nft:17:14-14: Error: syntax error, unexpected junk\n    ip saddr ' udp dport 5405 accept;\n             ^\n/etc/nftables.d/50-proxmox-mgmt.nft:74:14-14: Error: syntax error, unexpected junk\n    ip saddr ' tcp dport 22 accept;\n             ^\n/etc/nftables.d/50-proxmox-mgmt.nft:75:14-14: Error: syntax error, unexpected junk\n    ip saddr ' tcp dport 8006 accept;\n             ^", "stderr_lines": ["/etc/nftables.d/50-proxmox-mgmt.nft:10:14-14: Error: syntax error, unexpected '['", "    ip saddr [ tcp dport 22 accept;", "             ^", "/etc/nftables.d/50-proxmox-mgmt.nft:11:14-14: Error: syntax error, unexpected '['", "    ip saddr [ tcp dport 8006 accept;", "             ^", "/etc/nftables.d/50-proxmox-mgmt.nft:12:14-14: Error: syntax error, unexpected '['", "    ip saddr [ udp dport 5404 accept;", "             ^", "/etc/nftables.d/50-proxmox-mgmt.nft:13:14-14: Error: syntax error, unexpected '['", "    ip saddr [ udp dport 5405 accept;", "             ^", "/etc/nftables.d/50-proxmox-mgmt.nft:14:14-14: Error: syntax error, unexpected junk", "    ip saddr ' tcp dport 22 accept;", "             ^", "/etc/nftables.d/50-proxmox-mgmt.nft:15:14-14: Error: syntax error, unexpected junk", "    ip saddr ' tcp dport 8006 accept;", "             ^", "/etc/nftables.d/50-proxmox-mgmt.nft:16:14-14: Error: syntax error, unexpected junk", "    ip saddr ' udp dport 5404 accept;", "             ^", "/etc/nftables.d/50-proxmox-mgmt.nft:17:14-14: Error: syntax error, unexpected junk", "    ip saddr ' udp dport 5405 accept;", "             ^", "/etc/nftables.d/50-proxmox-mgmt.nft:74:14-14: Error: syntax error, unexpected junk", "    ip saddr ' tcp dport 22 accept;", "             ^", "/etc/nftables.d/50-proxmox-mgmt.nft:75:14-14: Error: syntax error, unexpected junk", "    ip saddr ' tcp dport 8006 accept;", "             ^"], "stdout": "", "stdout_lines": []}
fatal: [192.168.10.202]: FAILED! => {"changed": true, "cmd": ["nft", "-f", "/etc/nftables.d/50-proxmox-mgmt.nft"], "delta": "0:00:00.007955", "end": "2026-02-26 16:07:07.051782", "msg": "non-zero return code", "rc": 1, "start": "2026-02-26 16:07:07.043827", "stderr": "/etc/nftables.d/50-proxmox-mgmt.nft:10:14-14: Error: syntax error, unexpected '['\n    ip saddr [ tcp dport 22 accept;\n             ^\n/etc/nftables.d/50-proxmox-mgmt.nft:11:14-14: Error: syntax error, unexpected '['\n    ip saddr [ tcp dport 8006 accept;\n             ^\n/etc/nftables.d/50-proxmox-mgmt.nft:12:14-14: Error: syntax error, unexpected '['\n    ip saddr [ udp dport 5404 accept;\n             ^\n/etc/nftables.d/50-proxmox-mgmt.nft:13:14-14: Error: syntax error, unexpected '['\n    ip saddr [ udp dport 5405 accept;\n             ^\n/etc/nftables.d/50-proxmox-mgmt.nft:14:14-14: Error: syntax error, unexpected junk\n    ip saddr ' tcp dport 22 accept;\n             ^\n/etc/nftables.d/50-proxmox-mgmt.nft:15:14-14: Error: syntax error, unexpected junk\n    ip saddr ' tcp dport 8006 accept;\n             ^\n/etc/nftables.d/50-proxmox-mgmt.nft:16:14-14: Error: syntax error, unexpected junk\n    ip saddr ' udp dport 5404 accept;\n             ^\n/etc/nftables.d/50-proxmox-mgmt.nft:17:14-14: Error: syntax error, unexpected junk\n    ip saddr ' udp dport 5405 accept;\n             ^\n/etc/nftables.d/50-proxmox-mgmt.nft:74:14-14: Error: syntax error, unexpected junk\n    ip saddr ' tcp dport 22 accept;\n             ^\n/etc/nftables.d/50-proxmox-mgmt.nft:75:14-14: Error: syntax error, unexpected junk\n    ip saddr ' tcp dport 8006 accept;\n             ^", "stderr_lines": ["/etc/nftables.d/50-proxmox-mgmt.nft:10:14-14: Error: syntax error, unexpected '['", "    ip saddr [ tcp dport 22 accept;", "             ^", "/etc/nftables.d/50-proxmox-mgmt.nft:11:14-14: Error: syntax error, unexpected '['", "    ip saddr [ tcp dport 8006 accept;", "             ^", "/etc/nftables.d/50-proxmox-mgmt.nft:12:14-14: Error: syntax error, unexpected '['", "    ip saddr [ udp dport 5404 accept;", "             ^", "/etc/nftables.d/50-proxmox-mgmt.nft:13:14-14: Error: syntax error, unexpected '['", "    ip saddr [ udp dport 5405 accept;", "             ^", "/etc/nftables.d/50-proxmox-mgmt.nft:14:14-14: Error: syntax error, unexpected junk", "    ip saddr ' tcp dport 22 accept;", "             ^", "/etc/nftables.d/50-proxmox-mgmt.nft:15:14-14: Error: syntax error, unexpected junk", "    ip saddr ' tcp dport 8006 accept;", "             ^", "/etc/nftables.d/50-proxmox-mgmt.nft:16:14-14: Error: syntax error, unexpected junk", "    ip saddr ' udp dport 5404 accept;", "             ^", "/etc/nftables.d/50-proxmox-mgmt.nft:17:14-14: Error: syntax error, unexpected junk", "    ip saddr ' udp dport 5405 accept;", "             ^", "/etc/nftables.d/50-proxmox-mgmt.nft:74:14-14: Error: syntax error, unexpected junk", "    ip saddr ' tcp dport 22 accept;", "             ^", "/etc/nftables.d/50-proxmox-mgmt.nft:75:14-14: Error: syntax error, unexpected junk", "    ip saddr ' tcp dport 8006 accept;", "             ^"], "stdout": "", "stdout_lines": []}

PLAY RECAP *********************************************************************
192.168.10.201             : ok=4    changed=1    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   
192.168.10.202             : ok=4    changed=1    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   

